[
  {
    "objectID": "Project1.html",
    "href": "Project1.html",
    "title": "ST558 Project1-Group K: Hanan Ali & Wenna Han",
    "section": "",
    "text": "1. Read in the data and select only few columns as required.\n\nlibrary(tidyverse)\n\nWarning: package 'ggplot2' was built under R version 4.2.3\n\n\nWarning: package 'tidyr' was built under R version 4.2.3\n\n\nWarning: package 'readr' was built under R version 4.2.3\n\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\ndata &lt;- read_csv(\"https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010187N1, EDU010187N2, EDU010188N1, EDU010188...\ndbl (20): EDU010187F, EDU010187D, EDU010188F, EDU010188D, EDU010189F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ndata &lt;- data |&gt;\n  select(Area_name, STCOU, ends_with(\"D\")) |&gt;\n  rename(area_name=Area_name)\ndata\n\n# A tibble: 3,198 × 12\n   area_name     STCOU EDU010187D EDU010188D EDU010189D EDU010190D EDU010191D\n   &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 UNITED STATES 00000   40024299   39967624   40317775   40737600   41385442\n 2 ALABAMA       01000     733735     728234     730048     728252     725541\n 3 Autauga, AL   01001       6829       6900       6920       6847       7008\n 4 Baldwin, AL   01003      16417      16465      16799      17054      17479\n 5 Barbour, AL   01005       5071       5098       5068       5156       5173\n 6 Bibb, AL      01007       3557       3508       3571       3621       3652\n 7 Blount, AL    01009       7319       7223       7205       7209       7155\n 8 Bullock, AL   01011       2014       1980       1985       1983       1985\n 9 Butler, AL    01013       4640       4582       4610       4591       4544\n10 Calhoun, AL   01015      20939      20923      20907      20849      20768\n# ℹ 3,188 more rows\n# ℹ 5 more variables: EDU010192D &lt;dbl&gt;, EDU010193D &lt;dbl&gt;, EDU010194D &lt;dbl&gt;,\n#   EDU010195D &lt;dbl&gt;, EDU010196D &lt;dbl&gt;\n\n\n2. Convert the data into long format where each row has only one enrollment value for that Area_name.\n\nlibrary(tidyr)\ndata &lt;- data |&gt;\n  pivot_longer(cols=3:12,\n               names_to = \"label\",\n               values_to = \"enrollment_value\")\ndata\n\n# A tibble: 31,980 × 4\n   area_name     STCOU label      enrollment_value\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;\n 1 UNITED STATES 00000 EDU010187D         40024299\n 2 UNITED STATES 00000 EDU010188D         39967624\n 3 UNITED STATES 00000 EDU010189D         40317775\n 4 UNITED STATES 00000 EDU010190D         40737600\n 5 UNITED STATES 00000 EDU010191D         41385442\n 6 UNITED STATES 00000 EDU010192D         42088151\n 7 UNITED STATES 00000 EDU010193D         42724710\n 8 UNITED STATES 00000 EDU010194D         43369917\n 9 UNITED STATES 00000 EDU010195D         43993459\n10 UNITED STATES 00000 EDU010196D         44715737\n# ℹ 31,970 more rows\n\n\n3. Parse the “label” string\nFor the “label” column, the first three characters represent the survey with the next four representing the type of value you have from that survey. The last two digits prior to the “D” represent the year of the measurement.\n\nParse the “label” string to pull out the year and convert the year into a numeric value such as 1997 or 2002.\nGrab the first three characters and following four digits to create a new variable representing which measurement was grabbed.\n\n\n#create a function to convert two-digit character to four-digit numeric year.\nconvert_year &lt;- function(year) {\n  year &lt;- as.numeric(year)\n  ifelse(year &gt; 24, 1900 + year, 2000 + year)\n}\n\ndata &lt;- data |&gt;\n  # parse the \"label\" string\n  mutate(year=substr(label, 8, 9)) |&gt;\n  mutate(year=convert_year(year)) |&gt;\n  # grab measurement information\n  mutate(measurement = substr(label, 1, 7))\ndata\n\n# A tibble: 31,980 × 6\n   area_name     STCOU label      enrollment_value  year measurement\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n 1 UNITED STATES 00000 EDU010187D         40024299  1987 EDU0101    \n 2 UNITED STATES 00000 EDU010188D         39967624  1988 EDU0101    \n 3 UNITED STATES 00000 EDU010189D         40317775  1989 EDU0101    \n 4 UNITED STATES 00000 EDU010190D         40737600  1990 EDU0101    \n 5 UNITED STATES 00000 EDU010191D         41385442  1991 EDU0101    \n 6 UNITED STATES 00000 EDU010192D         42088151  1992 EDU0101    \n 7 UNITED STATES 00000 EDU010193D         42724710  1993 EDU0101    \n 8 UNITED STATES 00000 EDU010194D         43369917  1994 EDU0101    \n 9 UNITED STATES 00000 EDU010195D         43993459  1995 EDU0101    \n10 UNITED STATES 00000 EDU010196D         44715737  1996 EDU0101    \n# ℹ 31,970 more rows\n\n\n4. Create two data sets\n\none data set that contains only non-county data\none data set that contains only county level data\n\n\ndata_noncounty &lt;- data [-grep(pattern = \", \\\\w\\\\w\", data$area_name),]\ndata_noncounty\n\n# A tibble: 530 × 6\n   area_name     STCOU label      enrollment_value  year measurement\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n 1 UNITED STATES 00000 EDU010187D         40024299  1987 EDU0101    \n 2 UNITED STATES 00000 EDU010188D         39967624  1988 EDU0101    \n 3 UNITED STATES 00000 EDU010189D         40317775  1989 EDU0101    \n 4 UNITED STATES 00000 EDU010190D         40737600  1990 EDU0101    \n 5 UNITED STATES 00000 EDU010191D         41385442  1991 EDU0101    \n 6 UNITED STATES 00000 EDU010192D         42088151  1992 EDU0101    \n 7 UNITED STATES 00000 EDU010193D         42724710  1993 EDU0101    \n 8 UNITED STATES 00000 EDU010194D         43369917  1994 EDU0101    \n 9 UNITED STATES 00000 EDU010195D         43993459  1995 EDU0101    \n10 UNITED STATES 00000 EDU010196D         44715737  1996 EDU0101    \n# ℹ 520 more rows\n\ndata_county &lt;- data [grep(pattern = \", \\\\w\\\\w\", data$area_name),]\ndata_county\n\n# A tibble: 31,450 × 6\n   area_name   STCOU label      enrollment_value  year measurement\n   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n 1 Autauga, AL 01001 EDU010187D             6829  1987 EDU0101    \n 2 Autauga, AL 01001 EDU010188D             6900  1988 EDU0101    \n 3 Autauga, AL 01001 EDU010189D             6920  1989 EDU0101    \n 4 Autauga, AL 01001 EDU010190D             6847  1990 EDU0101    \n 5 Autauga, AL 01001 EDU010191D             7008  1991 EDU0101    \n 6 Autauga, AL 01001 EDU010192D             7137  1992 EDU0101    \n 7 Autauga, AL 01001 EDU010193D             7152  1993 EDU0101    \n 8 Autauga, AL 01001 EDU010194D             7381  1994 EDU0101    \n 9 Autauga, AL 01001 EDU010195D             7568  1995 EDU0101    \n10 Autauga, AL 01001 EDU010196D             7834  1996 EDU0101    \n# ℹ 31,440 more rows\n\n\n\nFor the county level data, add a class to the tibble called county.\nSimilarly, add a class to the non-county data called state.\n\n\nclass(data_county) &lt;- c(\"county\", class(data_county))\nclass(data_county)\n\n[1] \"county\"     \"tbl_df\"     \"tbl\"        \"data.frame\"\n\nclass(data_noncounty) &lt;- c(\"state\", class(data_noncounty))\nclass(data_noncounty)\n\n[1] \"state\"      \"tbl_df\"     \"tbl\"        \"data.frame\"\n\n\n5. For the county level tibble, create a new variable that describes which state one of these county measurements corresponds to.\n\ndata_county &lt;- data_county |&gt;\n  mutate(state = substr(area_name, nchar(area_name)-1, nchar(area_name)))\ndata_county\n\n# A tibble: 31,450 × 7\n   area_name   STCOU label      enrollment_value  year measurement state\n   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;\n 1 Autauga, AL 01001 EDU010187D             6829  1987 EDU0101     AL   \n 2 Autauga, AL 01001 EDU010188D             6900  1988 EDU0101     AL   \n 3 Autauga, AL 01001 EDU010189D             6920  1989 EDU0101     AL   \n 4 Autauga, AL 01001 EDU010190D             6847  1990 EDU0101     AL   \n 5 Autauga, AL 01001 EDU010191D             7008  1991 EDU0101     AL   \n 6 Autauga, AL 01001 EDU010192D             7137  1992 EDU0101     AL   \n 7 Autauga, AL 01001 EDU010193D             7152  1993 EDU0101     AL   \n 8 Autauga, AL 01001 EDU010194D             7381  1994 EDU0101     AL   \n 9 Autauga, AL 01001 EDU010195D             7568  1995 EDU0101     AL   \n10 Autauga, AL 01001 EDU010196D             7834  1996 EDU0101     AL   \n# ℹ 31,440 more rows\n\n\n6. For the non-county level tibble, create a new variable called “division” corresponding to the state’s classification of division here. If row corresponds to a non-state (i.e. UNITED STATES), return ERROR for the division. The code for this part will not be a ton of fun but can be made easier with the use of %in%.\n\n# define the state’s classification of division\nNortheast &lt;- c(\"CONNECTICUT\", \"MAINE\", \"MASSACHUSETTS\", \"NEW HAMPSHIRE\", \n               \"NEW JERSEY\", \"NEW YORK\", \"PENNSYLVANIA\", \"RHODE ISLAND\",\n               \"VERMONT\")\nMidwest &lt;- c(\"ILLINOIS\", \"INDIANA\", \"IOWA\", \"KANSAS\", \"MICHIGAN\", \n             \"MINNESOTA\", \"MISSOURI\", \"NEBRASKA\", \"NORTH DAKOTA\",\n             \"OHIO\", \"SOUTH DAKOTA\", \"WISCONSIN\")\nSouth &lt;- c(\"ALABAMA\", \"ARKANSAS\", \"DELAWARE\", \"DISTRICT OF COLUMBIA\",\n           \"FLORIDA\", \"GEORGIA\", \"KENTUCKY\", \"LOUISIANA\", \"MARYLAND\",\n           \"MISSISSIPPI\", \"NORTH CAROLINA\", \"OKLAHOMA\", \"SOUTH CAROLINA\",\n           \"TENNESSEE\", \"TEXAS\", \"VIRGINIA\", \"WEST VIRGINIA\")\nWest &lt;- c(\"ALASKA\", \"ARIZONA\", \"CALIFORNIA\", \"COLORADO\", \"HAWAII\", \"IDAHO\",\n          \"MONTANA\", \"NEVADA\", \"NEW MEXICO\", \"OREGON\", \"UTAH\", \"WASHINGTON\",\n          \"WYOMING\")\n\ndata_noncounty &lt;- data_noncounty |&gt;\n  # convert area_name to upper case\n  mutate(area_name = toupper(area_name)) |&gt;\n  # classify the states\n  mutate(division = ifelse(area_name == \"UNITED STATES\", \"ERROR\", \n                           ifelse (area_name %in% Northeast,\n                                   \"Northeast\", \n                                   ifelse(area_name %in% Midwest,\n                                          \"Midwest\", \n                                          ifelse(area_name %in% South,\n                                                 \"South\",\n                                                 ifelse(area_name %in% West, \n                                                        \"West\", \n                                                        #output CHECK if anything unexpected\n                                                        \"CHECK\"))))))\ndata_noncounty\n\n# A tibble: 530 × 7\n   area_name     STCOU label      enrollment_value  year measurement division\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   \n 1 UNITED STATES 00000 EDU010187D         40024299  1987 EDU0101     ERROR   \n 2 UNITED STATES 00000 EDU010188D         39967624  1988 EDU0101     ERROR   \n 3 UNITED STATES 00000 EDU010189D         40317775  1989 EDU0101     ERROR   \n 4 UNITED STATES 00000 EDU010190D         40737600  1990 EDU0101     ERROR   \n 5 UNITED STATES 00000 EDU010191D         41385442  1991 EDU0101     ERROR   \n 6 UNITED STATES 00000 EDU010192D         42088151  1992 EDU0101     ERROR   \n 7 UNITED STATES 00000 EDU010193D         42724710  1993 EDU0101     ERROR   \n 8 UNITED STATES 00000 EDU010194D         43369917  1994 EDU0101     ERROR   \n 9 UNITED STATES 00000 EDU010195D         43993459  1995 EDU0101     ERROR   \n10 UNITED STATES 00000 EDU010196D         44715737  1996 EDU0101     ERROR   \n# ℹ 520 more rows\n\n\nNow we want to repeat the above process for the 2nd component of the data set.\n\ndata2 &lt;- read_csv(\"https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010197N1, EDU010197N2, EDU010198N1, EDU010198...\ndbl (20): EDU010197F, EDU010197D, EDU010198F, EDU010198D, EDU010199F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n#Crate a function for steps 1 and 2\nfunction_for_step_1_2 &lt;- function(data2, value_col_name = \"enrollment_value\") {\n  data2 &lt;- data2 |&gt;\n    select(Area_name, STCOU, ends_with(\"D\")) |&gt;\n    rename(area_name = Area_name) |&gt;\n    pivot_longer(cols = 3:12, \n                 names_to = \"label\", \n                 values_to = value_col_name)\n  return(data2)\n}\n\n#Process data\ndata2 &lt;- function_for_step_1_2(data2)\n\n#Crate a function for step 3\nfunction_for_step_3 &lt;- function(data2) {\n  data2 &lt;- data2 %&gt;%\n    mutate(year = as.numeric(substr(label, 8, 9)),\n           year = ifelse(year &gt; 24, 1900 + year, 2000 + year),\n           measurement = substr(label, 1, 7))\n  return(data2)\n}\n\ndata2 &lt;- function_for_step_3(data2)\n\nfunction_for_step_5 &lt;- function(data_county2) {\n  data_county2 &lt;- data_county2 %&gt;%\n    mutate(state = substr(area_name, nchar(area_name) - 1, nchar(area_name)))\n  return(data_county2)\n}\n\n#Crate a function for step 6\nfunction_for_step_6 &lt;- function(data_noncounty2) {\n  Northeast &lt;- c(\"CONNECTICUT\", \"MAINE\", \"MASSACHUSETTS\", \"NEW HAMPSHIRE\", \n                 \"NEW JERSEY\", \"NEW YORK\", \"PENNSYLVANIA\", \"RHODE ISLAND\",\n                 \"VERMONT\")\n  Midwest &lt;- c(\"ILLINOIS\", \"INDIANA\", \"IOWA\", \"KANSAS\", \"MICHIGAN\", \n               \"MINNESOTA\", \"MISSOURI\", \"NEBRASKA\", \"NORTH DAKOTA\",\n               \"OHIO\", \"SOUTH DAKOTA\", \"WISCONSIN\")\n  South &lt;- c(\"ALABAMA\", \"ARKANSAS\", \"DELAWARE\", \"DISTRICT OF COLUMBIA\",\n             \"FLORIDA\", \"GEORGIA\", \"KENTUCKY\", \"LOUISIANA\", \"MARYLAND\",\n             \"MISSISSIPPI\", \"NORTH CAROLINA\", \"OKLAHOMA\", \"SOUTH CAROLINA\",\n             \"TENNESSEE\", \"TEXAS\", \"VIRGINIA\", \"WEST VIRGINIA\")\n  West &lt;- c(\"ALASKA\", \"ARIZONA\", \"CALIFORNIA\", \"COLORADO\", \"HAWAII\", \"IDAHO\",\n            \"MONTANA\", \"NEVADA\", \"NEW MEXICO\", \"OREGON\", \"UTAH\", \"WASHINGTON\",\n            \"WYOMING\")\n  \n  data_noncounty2 &lt;- data_noncounty2 %&gt;%\n    mutate(area_name = toupper(area_name),\n           division = case_when(\n             area_name == \"UNITED STATES\" ~ \"ERROR\",\n             area_name %in% Northeast ~ \"Northeast\",\n             area_name %in% Midwest ~ \"Midwest\",\n             area_name %in% South ~ \"South\",\n             area_name %in% West ~ \"West\",\n             TRUE ~ \"CHECK\"\n           ))\n  return(data_noncounty2)\n}\n\n#Crate a function for final step\nfunction_for_steps4_5_6 &lt;- function(data2) {\n  data_noncounty2 &lt;- data2[-grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n  data_county2 &lt;- data2[grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n  \n  class(data_noncounty2) &lt;- c(\"state\", class(data_noncounty2))\n  class(data_county2) &lt;- c(\"county\", class(data_county2))\n  \n  data_county2 &lt;- function_for_step_5(data_county2)\n  data_noncounty2 &lt;- function_for_step_6(data_noncounty2)\n  \n  return(list(noncounty2 = data_noncounty2, county2 = data_county2))\n}\n\n#Process data\nresults &lt;- function_for_steps4_5_6(data2)\ndata2_noncounty &lt;- results$noncounty\ndata2_county &lt;- results$county\n\nCreating wrapper function\n\n# Define wrapper function\nmy_wrapper &lt;- function(url, default_var_name = \"enrollment_value\") {\n  data &lt;- read_csv(url)\n  \n  # Function for steps 1 and 2\n  data &lt;- data %&gt;%\n    select(Area_name, STCOU, ends_with(\"D\")) %&gt;%\n    rename(area_name = Area_name) %&gt;%\n    pivot_longer(cols = 3:12, names_to = \"label\", values_to = default_var_name)\n  \n  # Function for step 3\n  data &lt;- data %&gt;%\n    mutate(year = as.numeric(substr(label, 8, 9)),\n           year = ifelse(year &gt; 24, 1900 + year, 2000 + year),\n           measurement = substr(label, 1, 7))\n  \n  # Function for steps 4, 5, and 6\n  function_for_steps4_5_6 &lt;- function(data2) {\n    data_noncounty2 &lt;- data2[-grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n    data_county2 &lt;- data2[grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n    \n    class(data_noncounty2) &lt;- c(\"state\", class(data_noncounty2))\n    class(data_county2) &lt;- c(\"county\", class(data_county2))\n    \n    data_county2 &lt;- function_for_step_5(data_county2)\n    data_noncounty2 &lt;- function_for_step_6(data_noncounty2)\n    \n    return(list(noncounty2 = data_noncounty2, county2 = data_county2))\n  }\n  \n  # Process data\n  results &lt;- function_for_steps4_5_6(data)\n  data_noncounty &lt;- results$noncounty2\n  data_county &lt;- results$county2\n  \n  # Return the results\n  return(list(noncounty = data_noncounty, county = data_county))\n}\n\n# Example usage:\nurl &lt;- \"https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv\"\nresults &lt;- my_wrapper(url)\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010197N1, EDU010197N2, EDU010198N1, EDU010198...\ndbl (20): EDU010197F, EDU010197D, EDU010198F, EDU010198D, EDU010199F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n# Access non-county and county data\ndata_noncounty3 &lt;- results$noncounty\ndata_county3 &lt;- results$county\n\nCall it and combine your data\n\n# URLs for the two CSV files\nurl1 &lt;- \"https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv\"\nurl2 &lt;- \"https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv\"  \n\n# Call the wrapper function for the first dataset\nresults1 &lt;- my_wrapper(url1, default_var_name = \"enrollment_value\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010187N1, EDU010187N2, EDU010188N1, EDU010188...\ndbl (20): EDU010187F, EDU010187D, EDU010188F, EDU010188D, EDU010189F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n# Process data\ndata1_noncounty &lt;- results1$noncounty\ndata1_county &lt;- results1$county\n\n# Call the wrapper function for the second dataset\nresults2 &lt;- my_wrapper(url2, default_var_name = \"enrollment_value\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010197N1, EDU010197N2, EDU010198N1, EDU010198...\ndbl (20): EDU010197F, EDU010197D, EDU010198F, EDU010198D, EDU010199F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n# Process data\ndata2_noncounty &lt;- results2$noncounty\ndata2_county &lt;- results2$county\n\nSingle short function\n\n#Creat combined short function\ncombine &lt;- function(results1, results2) {\n  combined_county &lt;- bind_rows(results1$county, results2$county)\n  combined_noncounty &lt;- bind_rows(results1$noncounty, results2$noncounty)\n  return(list(county = combined_county, noncounty = combined_noncounty))\n}\n\n#Process data\ncombined_results &lt;- combine(results1, results2)\ncombined_county &lt;- combined_results$county\ncombined_noncounty &lt;- combined_results$noncounty\n\n\n\n\nwrite a function that plots the mean value of the statistic (enrollment for this data set) across the years for each Division. That is, on the x-axis we want the numeric year value, on the y-axis we want the mean of the statistic for each Division and numeric year. Also, we want to remove observations at the ERROR setting of Division.\n\nplot.state &lt;- function(df, var_name = \"_your_default_value_\"){\n  # Calculate the mean of the statistic for each Division and year\n  df_summary &lt;- df |&gt;\n    filter(division != \"ERROR\") |&gt;  # Remove the ERROR setting\n    group_by(year, division) |&gt;  # Group by year and division\n    summarize(mean_statistic = mean(get(var_name)))  # Calculate mean\n  \n  # Create a line plot with ggplot\n  ggplot(df_summary, aes(x = year, y = mean_statistic, color = division)) +\n    geom_line() +\n    labs(title = paste(\"Mean\", var_name, \"across Years by Division\"),\n         x = \"year\",\n         y = paste(\"Mean\", var_name),\n         color = \"division\")\n}\n\nFor the class county we’ll do a similar plotting function but with more flexibility. This function should allow the user to: • specify the state of interest, giving a default value if not specified • determine whether the ‘top’ or ‘bottom’ most counties should be looked at with a default for ‘top’ • instruct how many of the ‘top’ or ‘bottom’ will be investigated with a default value of 5\n\nplot.county &lt;- function(df, State = \"default_state\", \n                        var_name = \"enrollment_value\", \n                        top_bottom = \"top\", \n                        num_counties = 5) {\n  # Filter data for the specified state\n  state_data &lt;- df |&gt;\n    filter(state == State)\n  \n  county_means &lt;- state_data |&gt;\n    group_by(area_name) |&gt; # Group by area_name\n    summarize(mean_statistic = mean(get(var_name))) |&gt; # Calculate mean\n    arrange(mean_statistic)\n    \n  # Sort values based on 'top' or 'bottom' specification\n  if (top_bottom == \"top\") {\n    sorted_counties &lt;- county_means |&gt;\n      arrange(desc(mean_statistic)) |&gt;\n      head(num_counties)\n  } else if (top_bottom == \"bottom\") {\n    sorted_counties &lt;- county_means |&gt;\n      arrange(mean_statistic) |&gt;\n      head(num_counties)\n  } else {\n    stop(\"Invalid value for top_bottom\")\n  }\n\n  # Filter the data for the specified counties\n  plot_data &lt;- state_data |&gt;\n    filter(area_name %in% sorted_counties$area_name)\n  \n  # Create the plot\n  ggplot(plot_data, aes(x = year, y = get(var_name), color = area_name)) +\n    geom_line() +\n    labs(title = paste(\"Mean\", var_name, \"for\", top_bottom, num_counties, \"Counties in\", State),\n      x = \"Year\",\n      y = paste(\"Mean\", var_name),\n      color = \"County\")\n}"
  },
  {
    "objectID": "Project1.html#data-processing",
    "href": "Project1.html#data-processing",
    "title": "ST558 Project1-Group K: Hanan Ali & Wenna Han",
    "section": "",
    "text": "1. Read in the data and select only few columns as required.\n\nlibrary(tidyverse)\n\nWarning: package 'ggplot2' was built under R version 4.2.3\n\n\nWarning: package 'tidyr' was built under R version 4.2.3\n\n\nWarning: package 'readr' was built under R version 4.2.3\n\n\nWarning: package 'dplyr' was built under R version 4.2.3\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\ndata &lt;- read_csv(\"https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010187N1, EDU010187N2, EDU010188N1, EDU010188...\ndbl (20): EDU010187F, EDU010187D, EDU010188F, EDU010188D, EDU010189F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ndata &lt;- data |&gt;\n  select(Area_name, STCOU, ends_with(\"D\")) |&gt;\n  rename(area_name=Area_name)\ndata\n\n# A tibble: 3,198 × 12\n   area_name     STCOU EDU010187D EDU010188D EDU010189D EDU010190D EDU010191D\n   &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;\n 1 UNITED STATES 00000   40024299   39967624   40317775   40737600   41385442\n 2 ALABAMA       01000     733735     728234     730048     728252     725541\n 3 Autauga, AL   01001       6829       6900       6920       6847       7008\n 4 Baldwin, AL   01003      16417      16465      16799      17054      17479\n 5 Barbour, AL   01005       5071       5098       5068       5156       5173\n 6 Bibb, AL      01007       3557       3508       3571       3621       3652\n 7 Blount, AL    01009       7319       7223       7205       7209       7155\n 8 Bullock, AL   01011       2014       1980       1985       1983       1985\n 9 Butler, AL    01013       4640       4582       4610       4591       4544\n10 Calhoun, AL   01015      20939      20923      20907      20849      20768\n# ℹ 3,188 more rows\n# ℹ 5 more variables: EDU010192D &lt;dbl&gt;, EDU010193D &lt;dbl&gt;, EDU010194D &lt;dbl&gt;,\n#   EDU010195D &lt;dbl&gt;, EDU010196D &lt;dbl&gt;\n\n\n2. Convert the data into long format where each row has only one enrollment value for that Area_name.\n\nlibrary(tidyr)\ndata &lt;- data |&gt;\n  pivot_longer(cols=3:12,\n               names_to = \"label\",\n               values_to = \"enrollment_value\")\ndata\n\n# A tibble: 31,980 × 4\n   area_name     STCOU label      enrollment_value\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;\n 1 UNITED STATES 00000 EDU010187D         40024299\n 2 UNITED STATES 00000 EDU010188D         39967624\n 3 UNITED STATES 00000 EDU010189D         40317775\n 4 UNITED STATES 00000 EDU010190D         40737600\n 5 UNITED STATES 00000 EDU010191D         41385442\n 6 UNITED STATES 00000 EDU010192D         42088151\n 7 UNITED STATES 00000 EDU010193D         42724710\n 8 UNITED STATES 00000 EDU010194D         43369917\n 9 UNITED STATES 00000 EDU010195D         43993459\n10 UNITED STATES 00000 EDU010196D         44715737\n# ℹ 31,970 more rows\n\n\n3. Parse the “label” string\nFor the “label” column, the first three characters represent the survey with the next four representing the type of value you have from that survey. The last two digits prior to the “D” represent the year of the measurement.\n\nParse the “label” string to pull out the year and convert the year into a numeric value such as 1997 or 2002.\nGrab the first three characters and following four digits to create a new variable representing which measurement was grabbed.\n\n\n#create a function to convert two-digit character to four-digit numeric year.\nconvert_year &lt;- function(year) {\n  year &lt;- as.numeric(year)\n  ifelse(year &gt; 24, 1900 + year, 2000 + year)\n}\n\ndata &lt;- data |&gt;\n  # parse the \"label\" string\n  mutate(year=substr(label, 8, 9)) |&gt;\n  mutate(year=convert_year(year)) |&gt;\n  # grab measurement information\n  mutate(measurement = substr(label, 1, 7))\ndata\n\n# A tibble: 31,980 × 6\n   area_name     STCOU label      enrollment_value  year measurement\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n 1 UNITED STATES 00000 EDU010187D         40024299  1987 EDU0101    \n 2 UNITED STATES 00000 EDU010188D         39967624  1988 EDU0101    \n 3 UNITED STATES 00000 EDU010189D         40317775  1989 EDU0101    \n 4 UNITED STATES 00000 EDU010190D         40737600  1990 EDU0101    \n 5 UNITED STATES 00000 EDU010191D         41385442  1991 EDU0101    \n 6 UNITED STATES 00000 EDU010192D         42088151  1992 EDU0101    \n 7 UNITED STATES 00000 EDU010193D         42724710  1993 EDU0101    \n 8 UNITED STATES 00000 EDU010194D         43369917  1994 EDU0101    \n 9 UNITED STATES 00000 EDU010195D         43993459  1995 EDU0101    \n10 UNITED STATES 00000 EDU010196D         44715737  1996 EDU0101    \n# ℹ 31,970 more rows\n\n\n4. Create two data sets\n\none data set that contains only non-county data\none data set that contains only county level data\n\n\ndata_noncounty &lt;- data [-grep(pattern = \", \\\\w\\\\w\", data$area_name),]\ndata_noncounty\n\n# A tibble: 530 × 6\n   area_name     STCOU label      enrollment_value  year measurement\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n 1 UNITED STATES 00000 EDU010187D         40024299  1987 EDU0101    \n 2 UNITED STATES 00000 EDU010188D         39967624  1988 EDU0101    \n 3 UNITED STATES 00000 EDU010189D         40317775  1989 EDU0101    \n 4 UNITED STATES 00000 EDU010190D         40737600  1990 EDU0101    \n 5 UNITED STATES 00000 EDU010191D         41385442  1991 EDU0101    \n 6 UNITED STATES 00000 EDU010192D         42088151  1992 EDU0101    \n 7 UNITED STATES 00000 EDU010193D         42724710  1993 EDU0101    \n 8 UNITED STATES 00000 EDU010194D         43369917  1994 EDU0101    \n 9 UNITED STATES 00000 EDU010195D         43993459  1995 EDU0101    \n10 UNITED STATES 00000 EDU010196D         44715737  1996 EDU0101    \n# ℹ 520 more rows\n\ndata_county &lt;- data [grep(pattern = \", \\\\w\\\\w\", data$area_name),]\ndata_county\n\n# A tibble: 31,450 × 6\n   area_name   STCOU label      enrollment_value  year measurement\n   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      \n 1 Autauga, AL 01001 EDU010187D             6829  1987 EDU0101    \n 2 Autauga, AL 01001 EDU010188D             6900  1988 EDU0101    \n 3 Autauga, AL 01001 EDU010189D             6920  1989 EDU0101    \n 4 Autauga, AL 01001 EDU010190D             6847  1990 EDU0101    \n 5 Autauga, AL 01001 EDU010191D             7008  1991 EDU0101    \n 6 Autauga, AL 01001 EDU010192D             7137  1992 EDU0101    \n 7 Autauga, AL 01001 EDU010193D             7152  1993 EDU0101    \n 8 Autauga, AL 01001 EDU010194D             7381  1994 EDU0101    \n 9 Autauga, AL 01001 EDU010195D             7568  1995 EDU0101    \n10 Autauga, AL 01001 EDU010196D             7834  1996 EDU0101    \n# ℹ 31,440 more rows\n\n\n\nFor the county level data, add a class to the tibble called county.\nSimilarly, add a class to the non-county data called state.\n\n\nclass(data_county) &lt;- c(\"county\", class(data_county))\nclass(data_county)\n\n[1] \"county\"     \"tbl_df\"     \"tbl\"        \"data.frame\"\n\nclass(data_noncounty) &lt;- c(\"state\", class(data_noncounty))\nclass(data_noncounty)\n\n[1] \"state\"      \"tbl_df\"     \"tbl\"        \"data.frame\"\n\n\n5. For the county level tibble, create a new variable that describes which state one of these county measurements corresponds to.\n\ndata_county &lt;- data_county |&gt;\n  mutate(state = substr(area_name, nchar(area_name)-1, nchar(area_name)))\ndata_county\n\n# A tibble: 31,450 × 7\n   area_name   STCOU label      enrollment_value  year measurement state\n   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;\n 1 Autauga, AL 01001 EDU010187D             6829  1987 EDU0101     AL   \n 2 Autauga, AL 01001 EDU010188D             6900  1988 EDU0101     AL   \n 3 Autauga, AL 01001 EDU010189D             6920  1989 EDU0101     AL   \n 4 Autauga, AL 01001 EDU010190D             6847  1990 EDU0101     AL   \n 5 Autauga, AL 01001 EDU010191D             7008  1991 EDU0101     AL   \n 6 Autauga, AL 01001 EDU010192D             7137  1992 EDU0101     AL   \n 7 Autauga, AL 01001 EDU010193D             7152  1993 EDU0101     AL   \n 8 Autauga, AL 01001 EDU010194D             7381  1994 EDU0101     AL   \n 9 Autauga, AL 01001 EDU010195D             7568  1995 EDU0101     AL   \n10 Autauga, AL 01001 EDU010196D             7834  1996 EDU0101     AL   \n# ℹ 31,440 more rows\n\n\n6. For the non-county level tibble, create a new variable called “division” corresponding to the state’s classification of division here. If row corresponds to a non-state (i.e. UNITED STATES), return ERROR for the division. The code for this part will not be a ton of fun but can be made easier with the use of %in%.\n\n# define the state’s classification of division\nNortheast &lt;- c(\"CONNECTICUT\", \"MAINE\", \"MASSACHUSETTS\", \"NEW HAMPSHIRE\", \n               \"NEW JERSEY\", \"NEW YORK\", \"PENNSYLVANIA\", \"RHODE ISLAND\",\n               \"VERMONT\")\nMidwest &lt;- c(\"ILLINOIS\", \"INDIANA\", \"IOWA\", \"KANSAS\", \"MICHIGAN\", \n             \"MINNESOTA\", \"MISSOURI\", \"NEBRASKA\", \"NORTH DAKOTA\",\n             \"OHIO\", \"SOUTH DAKOTA\", \"WISCONSIN\")\nSouth &lt;- c(\"ALABAMA\", \"ARKANSAS\", \"DELAWARE\", \"DISTRICT OF COLUMBIA\",\n           \"FLORIDA\", \"GEORGIA\", \"KENTUCKY\", \"LOUISIANA\", \"MARYLAND\",\n           \"MISSISSIPPI\", \"NORTH CAROLINA\", \"OKLAHOMA\", \"SOUTH CAROLINA\",\n           \"TENNESSEE\", \"TEXAS\", \"VIRGINIA\", \"WEST VIRGINIA\")\nWest &lt;- c(\"ALASKA\", \"ARIZONA\", \"CALIFORNIA\", \"COLORADO\", \"HAWAII\", \"IDAHO\",\n          \"MONTANA\", \"NEVADA\", \"NEW MEXICO\", \"OREGON\", \"UTAH\", \"WASHINGTON\",\n          \"WYOMING\")\n\ndata_noncounty &lt;- data_noncounty |&gt;\n  # convert area_name to upper case\n  mutate(area_name = toupper(area_name)) |&gt;\n  # classify the states\n  mutate(division = ifelse(area_name == \"UNITED STATES\", \"ERROR\", \n                           ifelse (area_name %in% Northeast,\n                                   \"Northeast\", \n                                   ifelse(area_name %in% Midwest,\n                                          \"Midwest\", \n                                          ifelse(area_name %in% South,\n                                                 \"South\",\n                                                 ifelse(area_name %in% West, \n                                                        \"West\", \n                                                        #output CHECK if anything unexpected\n                                                        \"CHECK\"))))))\ndata_noncounty\n\n# A tibble: 530 × 7\n   area_name     STCOU label      enrollment_value  year measurement division\n   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   \n 1 UNITED STATES 00000 EDU010187D         40024299  1987 EDU0101     ERROR   \n 2 UNITED STATES 00000 EDU010188D         39967624  1988 EDU0101     ERROR   \n 3 UNITED STATES 00000 EDU010189D         40317775  1989 EDU0101     ERROR   \n 4 UNITED STATES 00000 EDU010190D         40737600  1990 EDU0101     ERROR   \n 5 UNITED STATES 00000 EDU010191D         41385442  1991 EDU0101     ERROR   \n 6 UNITED STATES 00000 EDU010192D         42088151  1992 EDU0101     ERROR   \n 7 UNITED STATES 00000 EDU010193D         42724710  1993 EDU0101     ERROR   \n 8 UNITED STATES 00000 EDU010194D         43369917  1994 EDU0101     ERROR   \n 9 UNITED STATES 00000 EDU010195D         43993459  1995 EDU0101     ERROR   \n10 UNITED STATES 00000 EDU010196D         44715737  1996 EDU0101     ERROR   \n# ℹ 520 more rows\n\n\nNow we want to repeat the above process for the 2nd component of the data set.\n\ndata2 &lt;- read_csv(\"https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010197N1, EDU010197N2, EDU010198N1, EDU010198...\ndbl (20): EDU010197F, EDU010197D, EDU010198F, EDU010198D, EDU010199F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n#Crate a function for steps 1 and 2\nfunction_for_step_1_2 &lt;- function(data2, value_col_name = \"enrollment_value\") {\n  data2 &lt;- data2 |&gt;\n    select(Area_name, STCOU, ends_with(\"D\")) |&gt;\n    rename(area_name = Area_name) |&gt;\n    pivot_longer(cols = 3:12, \n                 names_to = \"label\", \n                 values_to = value_col_name)\n  return(data2)\n}\n\n#Process data\ndata2 &lt;- function_for_step_1_2(data2)\n\n#Crate a function for step 3\nfunction_for_step_3 &lt;- function(data2) {\n  data2 &lt;- data2 %&gt;%\n    mutate(year = as.numeric(substr(label, 8, 9)),\n           year = ifelse(year &gt; 24, 1900 + year, 2000 + year),\n           measurement = substr(label, 1, 7))\n  return(data2)\n}\n\ndata2 &lt;- function_for_step_3(data2)\n\nfunction_for_step_5 &lt;- function(data_county2) {\n  data_county2 &lt;- data_county2 %&gt;%\n    mutate(state = substr(area_name, nchar(area_name) - 1, nchar(area_name)))\n  return(data_county2)\n}\n\n#Crate a function for step 6\nfunction_for_step_6 &lt;- function(data_noncounty2) {\n  Northeast &lt;- c(\"CONNECTICUT\", \"MAINE\", \"MASSACHUSETTS\", \"NEW HAMPSHIRE\", \n                 \"NEW JERSEY\", \"NEW YORK\", \"PENNSYLVANIA\", \"RHODE ISLAND\",\n                 \"VERMONT\")\n  Midwest &lt;- c(\"ILLINOIS\", \"INDIANA\", \"IOWA\", \"KANSAS\", \"MICHIGAN\", \n               \"MINNESOTA\", \"MISSOURI\", \"NEBRASKA\", \"NORTH DAKOTA\",\n               \"OHIO\", \"SOUTH DAKOTA\", \"WISCONSIN\")\n  South &lt;- c(\"ALABAMA\", \"ARKANSAS\", \"DELAWARE\", \"DISTRICT OF COLUMBIA\",\n             \"FLORIDA\", \"GEORGIA\", \"KENTUCKY\", \"LOUISIANA\", \"MARYLAND\",\n             \"MISSISSIPPI\", \"NORTH CAROLINA\", \"OKLAHOMA\", \"SOUTH CAROLINA\",\n             \"TENNESSEE\", \"TEXAS\", \"VIRGINIA\", \"WEST VIRGINIA\")\n  West &lt;- c(\"ALASKA\", \"ARIZONA\", \"CALIFORNIA\", \"COLORADO\", \"HAWAII\", \"IDAHO\",\n            \"MONTANA\", \"NEVADA\", \"NEW MEXICO\", \"OREGON\", \"UTAH\", \"WASHINGTON\",\n            \"WYOMING\")\n  \n  data_noncounty2 &lt;- data_noncounty2 %&gt;%\n    mutate(area_name = toupper(area_name),\n           division = case_when(\n             area_name == \"UNITED STATES\" ~ \"ERROR\",\n             area_name %in% Northeast ~ \"Northeast\",\n             area_name %in% Midwest ~ \"Midwest\",\n             area_name %in% South ~ \"South\",\n             area_name %in% West ~ \"West\",\n             TRUE ~ \"CHECK\"\n           ))\n  return(data_noncounty2)\n}\n\n#Crate a function for final step\nfunction_for_steps4_5_6 &lt;- function(data2) {\n  data_noncounty2 &lt;- data2[-grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n  data_county2 &lt;- data2[grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n  \n  class(data_noncounty2) &lt;- c(\"state\", class(data_noncounty2))\n  class(data_county2) &lt;- c(\"county\", class(data_county2))\n  \n  data_county2 &lt;- function_for_step_5(data_county2)\n  data_noncounty2 &lt;- function_for_step_6(data_noncounty2)\n  \n  return(list(noncounty2 = data_noncounty2, county2 = data_county2))\n}\n\n#Process data\nresults &lt;- function_for_steps4_5_6(data2)\ndata2_noncounty &lt;- results$noncounty\ndata2_county &lt;- results$county\n\nCreating wrapper function\n\n# Define wrapper function\nmy_wrapper &lt;- function(url, default_var_name = \"enrollment_value\") {\n  data &lt;- read_csv(url)\n  \n  # Function for steps 1 and 2\n  data &lt;- data %&gt;%\n    select(Area_name, STCOU, ends_with(\"D\")) %&gt;%\n    rename(area_name = Area_name) %&gt;%\n    pivot_longer(cols = 3:12, names_to = \"label\", values_to = default_var_name)\n  \n  # Function for step 3\n  data &lt;- data %&gt;%\n    mutate(year = as.numeric(substr(label, 8, 9)),\n           year = ifelse(year &gt; 24, 1900 + year, 2000 + year),\n           measurement = substr(label, 1, 7))\n  \n  # Function for steps 4, 5, and 6\n  function_for_steps4_5_6 &lt;- function(data2) {\n    data_noncounty2 &lt;- data2[-grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n    data_county2 &lt;- data2[grep(pattern = \", \\\\w\\\\w\", data2$area_name), ]\n    \n    class(data_noncounty2) &lt;- c(\"state\", class(data_noncounty2))\n    class(data_county2) &lt;- c(\"county\", class(data_county2))\n    \n    data_county2 &lt;- function_for_step_5(data_county2)\n    data_noncounty2 &lt;- function_for_step_6(data_noncounty2)\n    \n    return(list(noncounty2 = data_noncounty2, county2 = data_county2))\n  }\n  \n  # Process data\n  results &lt;- function_for_steps4_5_6(data)\n  data_noncounty &lt;- results$noncounty2\n  data_county &lt;- results$county2\n  \n  # Return the results\n  return(list(noncounty = data_noncounty, county = data_county))\n}\n\n# Example usage:\nurl &lt;- \"https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv\"\nresults &lt;- my_wrapper(url)\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010197N1, EDU010197N2, EDU010198N1, EDU010198...\ndbl (20): EDU010197F, EDU010197D, EDU010198F, EDU010198D, EDU010199F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n# Access non-county and county data\ndata_noncounty3 &lt;- results$noncounty\ndata_county3 &lt;- results$county\n\nCall it and combine your data\n\n# URLs for the two CSV files\nurl1 &lt;- \"https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv\"\nurl2 &lt;- \"https://www4.stat.ncsu.edu/~online/datasets/EDU01b.csv\"  \n\n# Call the wrapper function for the first dataset\nresults1 &lt;- my_wrapper(url1, default_var_name = \"enrollment_value\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010187N1, EDU010187N2, EDU010188N1, EDU010188...\ndbl (20): EDU010187F, EDU010187D, EDU010188F, EDU010188D, EDU010189F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n# Process data\ndata1_noncounty &lt;- results1$noncounty\ndata1_county &lt;- results1$county\n\n# Call the wrapper function for the second dataset\nresults2 &lt;- my_wrapper(url2, default_var_name = \"enrollment_value\")\n\nRows: 3198 Columns: 42\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (22): Area_name, STCOU, EDU010197N1, EDU010197N2, EDU010198N1, EDU010198...\ndbl (20): EDU010197F, EDU010197D, EDU010198F, EDU010198D, EDU010199F, EDU010...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n# Process data\ndata2_noncounty &lt;- results2$noncounty\ndata2_county &lt;- results2$county\n\nSingle short function\n\n#Creat combined short function\ncombine &lt;- function(results1, results2) {\n  combined_county &lt;- bind_rows(results1$county, results2$county)\n  combined_noncounty &lt;- bind_rows(results1$noncounty, results2$noncounty)\n  return(list(county = combined_county, noncounty = combined_noncounty))\n}\n\n#Process data\ncombined_results &lt;- combine(results1, results2)\ncombined_county &lt;- combined_results$county\ncombined_noncounty &lt;- combined_results$noncounty\n\n\n\n\nwrite a function that plots the mean value of the statistic (enrollment for this data set) across the years for each Division. That is, on the x-axis we want the numeric year value, on the y-axis we want the mean of the statistic for each Division and numeric year. Also, we want to remove observations at the ERROR setting of Division.\n\nplot.state &lt;- function(df, var_name = \"_your_default_value_\"){\n  # Calculate the mean of the statistic for each Division and year\n  df_summary &lt;- df |&gt;\n    filter(division != \"ERROR\") |&gt;  # Remove the ERROR setting\n    group_by(year, division) |&gt;  # Group by year and division\n    summarize(mean_statistic = mean(get(var_name)))  # Calculate mean\n  \n  # Create a line plot with ggplot\n  ggplot(df_summary, aes(x = year, y = mean_statistic, color = division)) +\n    geom_line() +\n    labs(title = paste(\"Mean\", var_name, \"across Years by Division\"),\n         x = \"year\",\n         y = paste(\"Mean\", var_name),\n         color = \"division\")\n}\n\nFor the class county we’ll do a similar plotting function but with more flexibility. This function should allow the user to: • specify the state of interest, giving a default value if not specified • determine whether the ‘top’ or ‘bottom’ most counties should be looked at with a default for ‘top’ • instruct how many of the ‘top’ or ‘bottom’ will be investigated with a default value of 5\n\nplot.county &lt;- function(df, State = \"default_state\", \n                        var_name = \"enrollment_value\", \n                        top_bottom = \"top\", \n                        num_counties = 5) {\n  # Filter data for the specified state\n  state_data &lt;- df |&gt;\n    filter(state == State)\n  \n  county_means &lt;- state_data |&gt;\n    group_by(area_name) |&gt; # Group by area_name\n    summarize(mean_statistic = mean(get(var_name))) |&gt; # Calculate mean\n    arrange(mean_statistic)\n    \n  # Sort values based on 'top' or 'bottom' specification\n  if (top_bottom == \"top\") {\n    sorted_counties &lt;- county_means |&gt;\n      arrange(desc(mean_statistic)) |&gt;\n      head(num_counties)\n  } else if (top_bottom == \"bottom\") {\n    sorted_counties &lt;- county_means |&gt;\n      arrange(mean_statistic) |&gt;\n      head(num_counties)\n  } else {\n    stop(\"Invalid value for top_bottom\")\n  }\n\n  # Filter the data for the specified counties\n  plot_data &lt;- state_data |&gt;\n    filter(area_name %in% sorted_counties$area_name)\n  \n  # Create the plot\n  ggplot(plot_data, aes(x = year, y = get(var_name), color = area_name)) +\n    geom_line() +\n    labs(title = paste(\"Mean\", var_name, \"for\", top_bottom, num_counties, \"Counties in\", State),\n      x = \"Year\",\n      y = paste(\"Mean\", var_name),\n      color = \"County\")\n}"
  }
]